# Infrastructure Deployment Recommendations

## Executive Summary

This infrastructure plan was generated by Inframate based on analyzing your application's requirements and codebase structure.

### Recommended AWS Services:

AWS Fargate, Amazon ECR, Application Load Balancer, Amazon DocumentDB, Amazon S3, Amazon CloudFront, AWS Certificate Manager, Amazon Route 53, AWS CodePipeline, AWS CodeBuild, AWS CodeDeploy, AWS Secrets Manager, Amazon CloudWatch, AWS IAM, AWS VPC

## Detailed Recommendations

*   **Containerization:**
    *   The first and most crucial step is to **containerize the application using Docker**. Create a `Dockerfile` for the backend (Node.js) and potentially for building the frontend static assets.
    *   This will make deployments consistent and portable.
*   **Backend Deployment (Node.js Application):**
    *   **AWS Fargate:** Deploy the containerized Node.js backend as an AWS Fargate service. This provides serverless container orchestration, removing the need to manage EC2 instances.
    *   **Amazon ECR (Elastic Container Registry):** Store your Docker images in ECR.
    *   **Application Load Balancer (ALB):** Place an ALB in front of your Fargate service to distribute traffic, handle SSL termination, and provide a stable endpoint.
*   **Frontend Deployment (Static Assets from .tsx, .css, images):**
    *   **Amazon S3:** Host the built static frontend assets (HTML, CSS, JavaScript bundles, images) in an S3 bucket configured for static website hosting.
    *   **Amazon CloudFront:** Use CloudFront as a CDN in front of the S3 bucket to cache content globally, reduce latency, and improve performance. CloudFront can also serve traffic over HTTPS using a free AWS Certificate Manager (ACM) certificate.
*   **Database (MongoDB):**
    *   **Amazon DocumentDB (with MongoDB compatibility):** Use Amazon DocumentDB as a managed MongoDB-compatible database service. It handles patching, backups, scaling, and high availability.
*   **Networking:**
    *   **Amazon VPC:** Create a Virtual Private Cloud (VPC) with public and private subnets across multiple Availability Zones (AZs) for high availability.
    *   Place the ALB in public subnets.
    *   Place Fargate tasks and DocumentDB instances in private subnets.
    *   Use a NAT Gateway in public subnets to allow resources in private subnets (like Fargate tasks needing to pull images or access external APIs) to access the internet.
*   **CI/CD (Continuous Integration/Continuous Deployment):**
    *   **AWS CodeCommit/GitHub/Bitbucket:** Store your source code.
    *   **AWS CodeBuild:** To build your Docker images from the source code and push them to ECR. Also, to build your frontend static assets.
    *   **AWS CodeDeploy (or direct ECS update):** To deploy new versions of your application to Fargate.
    *   **AWS CodePipeline:** To orchestrate the entire CI/CD process from code commit to deployment.
*   **Security:**
    *   **AWS IAM (Identity and Access Management):** Use IAM roles with least privilege for Fargate tasks, CodeBuild, and other services.
    *   **Security Groups:** Implement strict security group rules to control traffic between your ALB, Fargate services, and DocumentDB.
    *   **AWS Secrets Manager:** Store database credentials, API keys, and other secrets securely.
    *   **AWS Certificate Manager (ACM):** Manage SSL/TLS certificates for your ALB and CloudFront distribution.
*   **Logging and Monitoring:**
    *   **Amazon CloudWatch:** Collect logs from Fargate, ALB, and DocumentDB. Set up alarms for key metrics (CPU/memory utilization, error rates, database connections).
*   **DNS:**
    *   **Amazon Route 53:** Manage your application's domain name and route traffic to your ALB (for backend API) and CloudFront distribution (for frontend).
*   **Scalability & High Availability:**
    *   Deploy Fargate services and DocumentDB clusters across multiple AZs.
    *   Configure Auto Scaling for your Fargate service based on CPU/memory utilization or custom metrics.

## Estimated Monthly Costs

This estimation assumes a small, production-ready setup. Costs can vary significantly based on actual usage, region (using `us-east-1` as an example), and instance sizes.
*   **Compute (AWS Fargate):**
    *   Assuming 2 tasks for HA, each with 1 vCPU and 2GB RAM.
    *   1 vCPU hour cost: ~$0.04656
    *   1 GB RAM hour cost: ~$0.00511
    *   Total per task per hour: (1 * $0.04656) + (2 * $0.00511) = $0.05678
    *   2 tasks * $0.05678/hour * 24 hours/day * 30 days/month = **~$81.76/month**
*   **Database (Amazon DocumentDB):**
    *   1 `db.t3.medium` instance (primary, assuming a small cluster for now, min 2 for HA for production): ~$0.093/hour
    *   If using 2 instances for HA: 2 * $0.093/hour * 24 hours/day * 30 days/month = **~$133.92/month**
    *   Storage (e.g., 20GB): ~$0.20/GB-month = **~$4.00/month**
    *   I/O: Highly variable, estimate ~$10/month initially.
    *   Backup Storage (e.g., 20GB): ~$0.021/GB-month = **~$0.42/month**
*   **Load Balancing (Application Load Balancer):**
    *   ALB hourly cost: ~$0.0252/hour * 24 * 30 = ~$18.14/month
    *   LCU usage (estimate low): 0.5 LCU * $0.008/LCU-hour * 24 * 30 = ~$2.88/month
    *   Total ALB: **~$21.02/month**
*   **Networking (NAT Gateway):**
    *   1 NAT Gateway hourly cost: ~$0.045/hour * 24 * 30 = ~$32.40/month
    *   Data processing (estimate 50GB): 50GB * $0.045/GB = ~$2.25/month
    *   Total NAT Gateway: **~$34.65/month**
*   **Storage (S3 for frontend assets):**
    *   Storage (e.g., 1GB): ~$0.023/GB-month = **~$0.02/month** (likely negligible)
    *   Requests: Likely fall within free tier or very low cost.
*   **CDN (CloudFront):**
    *   Data transfer out (e.g., 50GB to internet): 50GB * ~$0.085/GB = **~$4.25/month** (first 1TB free with AWS Free Tier annually)
*   **DNS (Route 53):**
    *   1 Hosted Zone: **~$0.50/month**
    *   Queries: Likely low, standard queries are cheap.
*   **Container Registry (ECR):**
    *   Storage (e.g., 1GB for images): ~$0.10/GB-month = **~$0.10/month** (500MB/month free for private repos)
*   **Secrets Manager:**
    *   1 secret: **~$0.40/month**
*   **CloudWatch:**
    *   Logs (Fargate, etc.): First 5GB free, then ~$0.50/GB. Estimate **~$5.00/month** for additional logging.
    *   Metrics/Alarms: Basic alarms usually free or very low cost.
**Estimated Total Monthly Cost:**
$81.76 (Fargate) + $133.92 (DocDB instances) + $4.00 (DocDB storage) + $10 (DocDB I/O) + $0.42 (DocDB Backup) + $21.02 (ALB) + $34.65 (NAT GW) + $0.02 (S3) + $4.25 (CloudFront) + $0.50 (Route 53) + $0.10 (ECR) + $0.40 (Secrets Manager) + $5.00 (CloudWatch)
= **Approximately $296.04/month**
*This is a rough estimate. Actual costs will depend on traffic, data storage, specific instance choices, and region. The DocumentDB cost is a significant portion; for development or very low-traffic scenarios, you might start with a single instance (not recommended for production HA) or consider self-hosting MongoDB on an EC2 for cost savings at the expense of operational overhead.*

*Note: These cost estimates are approximate and may vary based on usage patterns, region, and AWS pricing changes.*

## Deployment Instructions

1. **Prerequisites**:
   - AWS CLI configured with appropriate credentials
   - Terraform installed (v1.0.0+)

2. **Configuration**:
   - Update variables in `terraform.tfvars` to match your requirements
   - Review the Terraform files to ensure they meet your needs

3. **Deployment**:
   ```bash
   terraform init
   terraform plan
   terraform apply
   ```

4. **Cleanup**:
   ```bash
   terraform destroy
   ```

## Notes

- The Terraform files have been generated in the `terraform/` directory
- The configuration is based on the application requirements specified in `inframate.md`
- You may need to customize the Terraform files for your specific needs
